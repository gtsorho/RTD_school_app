<section class="py-1 bg-blueGray-50">
  <div class="w-full mb-12 xl:mb-0 px-4 mx-auto mt-24">
    <div
      class="relative flex flex-col min-w-0 break-words bg-white w-full mb-6 shadow-lg rounded"
    >
      <div class="rounded-t mb-0 px-4 py-3 border-0">
        <div class="flex flex-wrap items-center">
          <div class="w-full px-4 max-w-full flex justify-between">
            <h3 class="font-semibold text-base text-blueGray-700">
              Acadamic Year
            </h3>
            <p>{{ assessments.length || 0 }} item(s) Found</p>
          </div>
        </div>
      </div>

      <div class="block w-full overflow-auto max-h-96">
        <table class="items-center bg-transparent w-full border-collapse">
          <thead class="sticky top-0 bg-blueGray-50 z-10">
            <tr>
              <th
                class="px-2 text-blueGray-500 align-middle border border-solid border-blueGray-100 py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-bold bg-red-700 text-white text-left"
              >
                Assessment
              </th>
              <th
                class="px-2 text-blueGray-500 align-middle border border-solid border-blueGray-100 py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-bold bg-red-700 text-white text-left"
              >
                Weight
              </th>
              <th
                class="px-2 text-blueGray-500 align-middle border border-solid border-blueGray-100 py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-bold bg-red-700 text-white text-left"
              >
                Subject
              </th>
              <th
                class="px-2 text-blueGray-500 align-middle border border-solid border-blueGray-100 py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-bold bg-red-700 text-white text-left"
              >
                Acadamic Year
              </th>
              <th
                class="px-2 text-blueGray-500 align-middle border border-solid border-blueGray-100 py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-bold bg-red-700 text-white text-left"
              >
                Term
              </th>
              <th
                class="px-2 text-blueGray-500 align-middle border border-solid border-blueGray-100 py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-bold bg-red-700 text-white text-left"
              ></th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let assessment of assessments"
              (dblclick)="onUpdate(assessment)"
              class="hover:bg-red-50 text-gray-700 cursor-pointer"
            >
              <th
                class="border-t-0 px-2 capitalize align-start border-l-0 border-r-0 text-xs whitespace-nowrap p-4 text-left text-blueGray-700"
              >
                {{ assessment.type }}
              </th>
              <td
                class="border-t-0 px-2 capitalize align-start border-l-0 border-r-0 text-xs whitespace-nowrap p-4"
              >
                {{ assessment.weight }}
              </td>
              <td
                class="border-t-0 px-2 align-start border-l-0 border-r-0 text-xs whitespace-nowrap p-4"
              >
                {{ assessment.subject.name }}
              </td>
              <td
                class="border-t-0 px-2 align-start border-l-0 border-r-0 text-xs whitespace-nowrap p-4"
              >
                {{ assessment.academicYear.name }}
              </td>
              <td
                class="border-t-0 px-2 align-start border-l-0 border-r-0 text-xs whitespace-nowrap p-4"
              >
                {{ assessment.term.name }}
              </td>
              <td>
                <i
                  (click)="deleteItem(assessment.id || '')"
                  class="bi bi-trash3-fill text-red-500 hover:text-red-700 transform transition-transform duration-200 hover:text-sm"
                ></i>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</section>

<div
  class="group fixed bottom-14 right-14 p-2 flex items-end justify-end w-24 h-24"
>
  <!-- main -->
  <div
    class="text-white shadow-xl flex items-center justify-center p-3 rounded-full bg-gradient-to-r from-red-700 to-red-900 z-50 absolute"
  >
    <i
      class="group-hover:rotate-90 transition-all duration-[0.6s] fa-solid text-2xl px-1.5 fa-plus"
    ></i>
  </div>
  <!-- sub top -->
  <div
    (click)="openModal()"
    class="absolute rounded-full transition-all duration-[0.2s] ease-out scale-x-0 group-hover:scale-x-100 group-hover:-translate-y-20 flex p-2 hover:p-3 bg-blue-900 hover:bg-blue-950 text-white"
  >
    <i class="fa-solid fa-user-plus p-1"></i>
  </div>
  <!-- sub middle -->
  <button
    disabled
    class="absolute disabled:transition-none disabled:group-hover:p-2 rounded-full transition-all duration-[0.2s] ease-out scale-x-0 group-hover:scale-x-100 group-hover:-translate-y-14 group-hover:-translate-x-14 flex p-2 hover:p-3 bg-yellow-900 hover:bg-yellow-950 text-white disabled:text-gray-200 disabled:bg-slate-500"
  >
    <i class="fa-solid fa-file-import p-1"></i>
  </button>
</div>

<div class="flex items-center justify-center">
  <div>
    <!-- Background overlay -->
    <div
      *ngIf="showModal"
      class="fixed inset-0 transition-opacity"
      (click)="closeModal()"
      aria-hidden="true"
    >
      <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
    </div>

    <!-- Modal -->
    <div *ngIf="showModal" class="fixed z-10 inset-0 overflow-y-auto">
      <div
        class="flex items-end justify-center content-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"
      >
        <form
          (ngSubmit)="isUpdate ? updateForm() : submitForm()"
          #formRef="ngForm"
          class="w-full border-t-8 border-red-700 inline-block align-bottom bg-white rounded-sm text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"
          role="dialog"
          aria-modal="true"
          aria-labelledby="modal-headline"
        >
          <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
            <div class="sm:flex sm:items-start">
              <div class="mt-7 text-center sm:mt-0 sm:ml-4 sm:text-left w-full">
                <div class="flex justify-start space-x-3">
                  <div
                    class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10"
                  >
                    <i class="bi bi-calendar-plus text-red-600"></i>
                  </div>
                  <h3
                    class="text-lg leading-6 font-bold text-gray-700 pt-2"
                    id="modal-headline"
                  >
                    {{ isUpdate ? "Update" : "Add" }} Assessment
                  </h3>
                </div>
                <div class="mt-7">
                  <div
                    class="grid gap-4 gap-y-2 text-sm grid-cols-1 md:grid-cols-6"
                  >
                    <div class="md:col-span-4">
                      <label for="type" class="text-gray-600">Type</label>
                      <select
                        id="type"
                        name="type"
                        [(ngModel)]="assessment.type"
                        class="h-8 border text-gray-700 focus:border-red-700 focus:ring-red-700 focus:outline-none mt-1 rounded px-4 w-full bg-gray-50"
                      >
                        <option [value]="'quiz'">Quiz</option>
                        <option [value]="'final'">Final</option>
                        <option [value]="'midterm'">Midterm</option>
                        <option [value]="'assignment'">Assignment</option>
                        <option [value]="'project'">Project</option>
                        <option [value]="'continuous assessment'">
                          Continuous Assessment
                        </option>
                      </select>
                    </div>

                    <div class="md:col-span-2">
                      <label for="weight" class="text-gray-600">Weight</label>
                      <input
                        type="text"
                        id="weight"
                        name="weight"
                        [(ngModel)]="assessment.weight"
                        placeholder="2023-2024 academic year"
                        class="h-8 border text-gray-700 focus:border-red-700 focus:ring-red-700 focus:outline-none mt-1 rounded px-4 w-full bg-gray-50"
                      />
                    </div>

                    <div class="md:col-span-3">
                      <label for="subject" class="text-gray-600">Subject</label>
                      <select
                        id="subject"
                        name="subject"
                        [(ngModel)]="assessment.subject_id"
                        class="h-8 border text-gray-700 focus:border-red-700 focus:ring-red-700 focus:outline-none mt-1 rounded px-4 w-full bg-gray-50"
                      >
                        <option
                          *ngFor="let subject of subjects"
                          [value]="subject.id"
                        >
                          {{ subject.name }}
                        </option>
                        <option value="99">
                          All Subjects
                        </option>
                      </select>
                    </div>

                    <div class="md:col-span-3">
                      <label for="term" class="text-gray-600">Term</label>
                      <select
                        id="term"
                        name="term"
                        [(ngModel)]="assessment.term_id"
                        class="h-8 border text-gray-700 focus:border-red-700 focus:ring-red-700 focus:outline-none mt-1 rounded px-4 w-full bg-gray-50"
                      >
                        <option *ngFor="let term of terms" [value]="term.id">
                          {{ term.name }}
                        </option>
                      </select>
                    </div>

                    <div class="md:col-span-3">
                      <label for="acadamicyear" class="text-gray-600"
                        >Acadamic Year</label
                      >
                      <select
                        id="acadamicyear"
                        name="acadamicyear"
                        [(ngModel)]="assessment.academic_year_id"
                        class="h-8 border text-gray-700 focus:border-red-700 focus:ring-red-700 focus:outline-none mt-1 rounded px-4 w-full bg-gray-50"
                      >
                        <option [value]="activeYear.id">
                          {{ activeYear.name }}
                        </option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div *ngIf="errorMessage" class="text-red-500 text-sm mt-2">
            {{ errorMessage }}
          </div>

          <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
            <button
              type="submit"
              class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-500 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm"
            >
              Submit
            </button>
            <button
              (click)="showModal = false"
              type="button"
              class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-200 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"
            >
              Cancel
            </button>
          </div>
          <div
            *ngIf="loading"
            class="absolute inset-0 flex items-center justify-center bg-gray-500 bg-opacity-70"
          >
            <app-spinner color="spinner-white" size="spinner-sm"></app-spinner>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
